<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern CRUD Application with JavaScript & Bootstrap</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert2 for notifications -->
</head>
<body>

<div class="container mt-5">
    <h2>Login</h2>
    <form id="loginForm">
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" id="username" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>

    <h2 class="mt-5">Register</h2>
    <form id="registerForm">
        <div class="form-group">
            <label for="regUsername">Username:</label>
            <input type="text" class="form-control" id="regUsername" required>
        </div>
        <div class="form-group">
            <label for="regEmail">Email:</label>
            <input type="email" class="form-control" id="regEmail" required>
        </div>
        <div class="form-group">
            <label for="regPassword">Password:</label>
            <input type="password" class="form-control" id="regPassword" required>
        </div>
        <button type="submit" class="btn btn-primary">Register</button>
    </form>

    <h2 class="mt-5">Admin Dashboard</h2>
    <div id="adminSection" class="d-none">
        <nav>
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" href="#adminUsers" data-toggle="tab">Manage Users</a></li>
                <li class="nav-item"><a class="nav-link" href="#adminProducts" data-toggle="tab">Manage Products</a></li>
                <li class="nav-item"><a class="nav-link" href="#adminTransactions" data-toggle="tab">Manage Transactions</a></li>
            </ul>
        </nav>

        <div class="tab-content mt-4">
            <div id="adminUsers" class="tab-pane fade show active">
                <h3>Manage Users</h3>
                <div class="form-group">
                    <input type="text" id="searchUser" class="form-control" placeholder="Search Users">
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminUsersTable"></tbody>
                </table>
            </div>

            <div id="adminProducts" class="tab-pane fade">
                <h3>Manage Products</h3>
                <form id="addProductForm">
                    <div class="form-group">
                        <label for="productName">Product Name:</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Product Price:</label>
                        <input type="number" class="form-control" id="productPrice" required>
                    </div>
                    <div class="form-group">
                        <label for="productStock">Product Stock:</label>
                        <input type="number" class="form-control" id="productStock" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </form>

                <div class="mt-4">
                    <input type="text" id="searchProduct" class="form-control" placeholder="Search Products">
                    <ul class="list-group mt-2" id="productsList"></ul>
                </div>
            </div>

            <div id="adminTransactions" class="tab-pane fade">
                <h3>Manage Transactions</h3>
                <div class="form-group">
                    <label for="transactionFilter">Filter By Date:</label>
                    <input type="date" class="form-control" id="transactionFilter">
                </div>
                <button class="btn btn-primary" onclick="filterTransactions()">Filter Transactions</button>
                <ul class="list-group mt-3" id="transactionsList"></ul>
            </div>
        </div>
    </div>

    <h2 class="mt-5">User Dashboard</h2>
    <div id="userSection" class="d-none">
        <h3>Products</h3>
        <ul id="userProductsList"></ul>
        <h3>Order Product</h3>
        <form id="orderForm">
            <div class="form-group">
                <input type="number" class="form-control" id="orderProductId" placeholder="Product ID" required>
            </div>
            <div class="form-group">
                <input type="number" class="form-control" id="orderQuantity" placeholder="Quantity" required>
            </div>
            <button type="submit" class="btn btn-primary">Place Order</button>
        </form>
    </div>
</div>

<script>
    const users = [
        { id: 1, username: 'admin', password: 'admin123', email: 'admin@example.com', role: 'admin' },
        { id: 2, username: 'kasir1', password: 'kasir123', email: 'kasir1@example.com', role: 'kasir' },
        { id: 3, username: 'user1', password: 'user123', email: 'user1@example.com', role: 'pengguna' }
    ];

    const products = [
        { id: 1, name: 'Laptop', price: 1000.00, stock: 10 },
        { id: 2, name: 'Mouse', price: 20.00, stock: 50 }
    ];

    const transactions = [
        { id: 1, productId: 1, username: 'user1', quantity: 1, date: '2025-01-01' },
        { id: 2, productId: 2, username: 'user1', quantity: 2, date: '2025-01-02' }
    ];

    $(document).ready(function() {
        // Login form submission
        $('#loginForm').submit(function(e) {
            e.preventDefault();
            const username = $('#username').val();
            const password = $('#password').val();
            
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                sessionStorage.setItem('user', JSON.stringify(user));
                if (user.role === 'admin') {
                    $('#adminSection').removeClass('d-none');
                    $('#userSection').addClass('d-none');
                    $('#adminUsers a[href="#adminUsers"]').tab('show');
                    displayAdminUsers();
                } else if (user.role === 'pengguna') {
                    $('#userSection').removeClass('d-none');
                    $('#adminSection').addClass('d-none');
                    displayUserProducts();
                }
            } else {
                Swal.fire('Error!', 'Invalid username or password.', 'error');
            }
        });

        // Register form submission
        $('#registerForm').submit(function(e) {
            e.preventDefault();
            const username = $('#regUsername').val();
            const email = $('#regEmail').val();
            const password = $('#regPassword').val();
            
            const newUser = { id: users.length + 1, username, password, email, role: 'pengguna' };
            users.push(newUser);
            sessionStorage.setItem('user', JSON.stringify(newUser));
            Swal.fire('Success!', 'User registered successfully.', 'success');
            $('#regUsername, #regEmail, #regPassword').val('');
        });

        function displayAdminUsers() {
            const adminUsersTable = $('#adminUsersTable');
            adminUsersTable.empty();
            users.forEach(user => {
                if (user.role === 'pengguna') {
                    adminUsersTable.append(`<tr>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${user.role}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
                        </td>
                    </tr>`);
                }
            });

            $('#searchUser').on('keyup', function() {
                const searchValue = $(this).val().toLowerCase();
                $('#adminUsersTable tr').each(function() {
                    const username = $(this).find('td:first').text().toLowerCase();
                    $(this).toggle(username.indexOf(searchValue) > -1);
                });
            });
        }

        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            $('#regUsername').val(user.username);
            $('#regEmail').val(user.email);
            $('#regPassword').val(user.password);
            $('#registerForm').off('submit').submit(function(e) {
                e.preventDefault();
                user.username = $('#regUsername').val();
                user.email = $('#regEmail').val();
                user.password = $('#regPassword').val();
                sessionStorage.setItem('user', JSON.stringify(user));
                Swal.fire('Success!', 'User updated successfully.', 'success');
                displayAdminUsers();
                resetRegisterForm();
            });
        }

        function deleteUser(userId) {
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex > -1) {
                users.splice(userIndex, 1);
                displayAdminUsers();
                Swal.fire('Success!', 'User deleted successfully.', 'success');
            }
        }

        function displayProducts() {
            const productsList = $('#productsList');
            productsList.empty();
            products.forEach(product => {
                productsList.append(`<li class="list-group-item">${product.name} - $${product.price} - Stock: ${product.stock}</li>`);
            });

            $('#searchProduct').on('keyup', function() {
                const searchValue = $(this).val().toLowerCase();
                $('#productsList li').each(function() {
                    const productName = $(this).text().toLowerCase();
                    $(this).toggle(productName.indexOf(searchValue) > -1);
                });
            });
        }

        function displayUserProducts() {
            const userProductsList = $('#userProductsList');
            userProductsList.empty();
            products.forEach(product => {
                userProductsList.append(`<li>${product.name} - $${product.price} - Stock: ${product.stock}</li>`);
            });
        }

        $('#addProductForm').submit(function(e) {
            e.preventDefault();
            const productName = $('#productName').val();
            const productPrice = $('#productPrice').val();
            const productStock = $('#productStock').val();

            const newProduct = { id: products.length + 1, name: productName, price: productPrice, stock: productStock };
            products.push(newProduct);
            Swal.fire('Success!', 'Product added successfully.', 'success');
            displayProducts();
        });

        function filterTransactions() {
            const filterDate = $('#transactionFilter').val();
            const filteredTransactions = transactions.filter(t => t.date === filterDate);
            displayTransactions(filteredTransactions);
        }

        function displayTransactions(filteredData) {
            const transactionsList = $('#transactionsList');
            transactionsList.empty();
            (filteredData || transactions).forEach(t => {
                const product = products.find(p => p.id === t.productId);
                transactionsList.append(`<li class="list-group-item">User: ${t.username}, Product: ${product.name}, Quantity: ${t.quantity}, Date: ${t.date}</li>`);
            });
        }

        $('#orderForm').submit(function(e) {
            e.preventDefault();
            const productId = parseInt($('#orderProductId').val());
            const quantity = parseInt($('#orderQuantity').val());

            const user = JSON.parse(sessionStorage.getItem('user'));
            const product = products.find(p => p.id === productId);

            if (product && product.stock >= quantity) {
                product.stock -= quantity;
                transactions.push({ id: transactions.length + 1, productId, username: user.username, quantity, date: new Date().toISOString().split('T')[0] });
                Swal.fire('Success!', 'Order placed successfully.', 'success');
                displayUserProducts();
                displayTransactions();
            } else {
                Swal.fire('Error!', 'Insufficient stock or invalid product.', 'error');
            }
        });

        function resetRegisterForm() {
            $('#registerForm').off('submit').submit(function(e) {
                e.preventDefault();
                const username = $('#regUsername').val();
                const email = $('#regEmail').val();
                const password = $('#regPassword').val();
                
                const newUser = { id: users.length + 1, username, password, email, role: 'pengguna' };
                users.push(newUser);
                sessionStorage.setItem('user', JSON.stringify(newUser));
                Swal.fire('Success!', 'User registered successfully.', 'success');
                $('#regUsername, #regEmail, #regPassword').val('');
            });
        }
    });
</script>

</body>
</html>
